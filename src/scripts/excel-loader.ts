import { PrismaClient } from '@prisma/client';
import * as XLSX from 'xlsx';
import fs from 'fs';
import path from 'path';

const prisma = new PrismaClient();

// –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ Excel
interface EventData {
  title: string;
  description?: string;
  image: string;
  gallery?: string;
  tickets?: string;
  startDate: string;
  endDate?: string;
  location: string;
  organizer: string;
  minPrice?: number;
  maxPrice?: number;
  isPaid: boolean;
  city: string;
  citySlug?: string;
  category: string;
  categoryId?: number;
  coordinates?: string;
  ageFrom?: number;
  ageTo?: number;
  ageGroups?: string;
  isPopular?: boolean;
  isPromoted?: boolean;
  priority?: number;
  status?: string;
  order?: number;
  quickFilterIds?: string;
  richDescription?: string;
  // –ë–∏–ª–µ—Ç—ã –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏
  ticketName1?: string;
  ticketPrice1?: number;
  ticketCurrency1?: string;
  ticketName2?: string;
  ticketPrice2?: number;
  ticketCurrency2?: string;
  ticketName3?: string;
  ticketPrice3?: number;
  ticketCurrency3?: string;
}

interface VenueData {
  name: string;
  description?: string;
  image: string;
  additionalImages?: string;
  location: string;
  district?: string;
  metro?: string;
  priceFrom?: number;
  priceTo?: number;
  city: string;
  citySlug?: string;
  subcategory: string;
  subcategoryId?: number;
  coordinates?: string;
  ageFrom?: number;
  ageTo?: number;
  tariff?: string;
  status?: string;
  moderationReason?: string;
  timezone?: string;
  fiasId?: string;
  kladrId?: string;
  workingHours?: string;
  richDescription?: string;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –∏–∑ Excel
export async function loadEventsFromExcel(filePath: string) {
  try {
    console.log(`üìÖ –ó–∞–≥—Ä—É–∂–∞–µ–º –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –∏–∑ Excel —Ñ–∞–π–ª–∞: ${filePath}`);
    
    // –ß–∏—Ç–∞–µ–º Excel —Ñ–∞–π–ª
    const workbook = XLSX.readFile(filePath);
    const sheetName = workbook.SheetNames[0]; // –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π –ª–∏—Å—Ç
    const worksheet = workbook.Sheets[sheetName];
    const eventsData: EventData[] = XLSX.utils.sheet_to_json(worksheet);
    
    console.log(`üìä –ù–∞–π–¥–µ–Ω–æ ${eventsData.length} –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏`);
    
    let successCount = 0;
    let errorCount = 0;
    
    for (const eventData of eventsData) {
      try {
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π slug
        let slug = eventData.title
          .toLowerCase()
          .replace(/[^a-z0-9–∞-—è\s]/g, '')
          .replace(/\s+/g, '-')
          .substring(0, 50);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å slug
        let counter = 1;
        let originalSlug = slug;
        while (await prisma.afishaEvent.findUnique({ where: { slug } })) {
          slug = `${originalSlug}-${counter}`;
          counter++;
        }
        
        // –ü–∞—Ä—Å–∏–º ageGroups –µ—Å–ª–∏ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞
        let ageGroupsArray = null;
        if (eventData.ageGroups) {
          try {
            ageGroupsArray = JSON.parse(eventData.ageGroups);
          } catch {
            // –ï—Å–ª–∏ –Ω–µ JSON, —Ç–æ —Ä–∞–∑–¥–µ–ª—è–µ–º –ø–æ –∑–∞–ø—è—Ç–æ–π
            ageGroupsArray = eventData.ageGroups.split(',').map(g => g.trim());
          }
        }
        
        // –°–æ–∑–¥–∞–µ–º –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ
        const event = await prisma.afishaEvent.create({
          data: {
            title: eventData.title,
            slug: slug,
            description: eventData.description || null,
            coverImage: eventData.image,
            gallery: eventData.gallery || null,
            tickets: eventData.tickets || null,
            venue: eventData.location,
            organizer: eventData.organizer,
            startDate: eventData.startDate ? new Date(eventData.startDate) : null,
            endDate: eventData.endDate ? new Date(eventData.endDate) : null,
            minPrice: eventData.minPrice || null,
            isPaid: eventData.isPaid,
            city: eventData.city,
            citySlug: eventData.citySlug || null,
            categoryName: eventData.category,
            categoryId: eventData.categoryId || null,
            coordinates: eventData.coordinates || null,
            ageFrom: eventData.ageFrom || null,
            ageTo: eventData.ageTo || null,
            ageGroups: ageGroupsArray ? JSON.stringify(ageGroupsArray) : null,
            isPopular: eventData.isPopular || false,
            isPromoted: eventData.isPromoted || false,
            priority: eventData.priority || 5,
            status: eventData.status || 'active',
            order: eventData.order || 0,
            quickFilterIds: eventData.quickFilterIds || null,
            richDescription: eventData.richDescription || null,
            viewCount: 0,
            searchText: `${eventData.title} ${eventData.description || ''} ${eventData.location}`.toLowerCase(),
            createdAt: new Date(),
            updatedAt: new Date(),
          }
        });
        
        // –°–æ–∑–¥–∞–µ–º —Ç–∏–ø—ã –±–∏–ª–µ—Ç–æ–≤, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
        const ticketTypes = [
          { name: eventData.ticketName1, price: eventData.ticketPrice1, currency: eventData.ticketCurrency1 },
          { name: eventData.ticketName2, price: eventData.ticketPrice2, currency: eventData.ticketCurrency2 },
          { name: eventData.ticketName3, price: eventData.ticketPrice3, currency: eventData.ticketCurrency3 }
        ].filter(ticket => ticket.name && ticket.price);
        
        for (const ticketType of ticketTypes) {
          await prisma.eventTicketType.create({
            data: {
              eventId: event.id,
              name: ticketType.name!,
              price: ticketType.price!,
              currency: ticketType.currency || 'RUB',
            }
          });
        }
        
        console.log(`‚úÖ –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ —Å–æ–∑–¥–∞–Ω–æ: ${event.title}`);
        successCount++;
        
      } catch (error) {
        console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è "${eventData.title}":`, error);
        errorCount++;
      }
    }
    
    console.log(`\nüìà –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π:`);
    console.log(`‚úÖ –£—Å–ø–µ—à–Ω–æ: ${successCount}`);
    console.log(`‚ùå –û—à–∏–±–æ–∫: ${errorCount}`);
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π:', error);
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ—Å—Ç –∏–∑ Excel
export async function loadVenuesFromExcel(filePath: string) {
  try {
    console.log(`üè¢ –ó–∞–≥—Ä—É–∂–∞–µ–º –º–µ—Å—Ç–∞ –∏–∑ Excel —Ñ–∞–π–ª–∞: ${filePath}`);
    
    // –ß–∏—Ç–∞–µ–º Excel —Ñ–∞–π–ª
    const workbook = XLSX.readFile(filePath);
    const sheetName = workbook.SheetNames[0];
    const worksheet = workbook.Sheets[sheetName];
    const venuesData: VenueData[] = XLSX.utils.sheet_to_json(worksheet);
    
    console.log(`üìä –ù–∞–π–¥–µ–Ω–æ ${venuesData.length} –º–µ—Å—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏`);
    
    let successCount = 0;
    let errorCount = 0;
    
    for (const venueData of venuesData) {
      try {
        // –ü–∞—Ä—Å–∏–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
        let lat = null;
        let lng = null;
        if (venueData.coordinates) {
          const coords = venueData.coordinates.split(',');
          if (coords.length === 2) {
            lat = parseFloat(coords[0].trim());
            lng = parseFloat(coords[1].trim());
          }
        }
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º slug –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏—è
        const slug = venueData.name
          .toLowerCase()
          .replace(/[^a-z0-9–∞-—è\s]/g, '')
          .replace(/\s+/g, '-')
          .substring(0, 50);
        
        // –ù–∞—Ö–æ–¥–∏–º –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º vendor (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ)
        const existingVendor = await prisma.vendor.findFirst();
        if (!existingVendor) {
          console.error('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω –Ω–∏ –æ–¥–∏–Ω vendor –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –°–æ–∑–¥–∞–π—Ç–µ vendor –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –º–µ—Å—Ç.');
          continue;
        }
        
        // –ù–∞—Ö–æ–¥–∏–º subcategoryId (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é)
        const existingSubcategory = await prisma.venueSubcategory.findFirst();
        if (!existingSubcategory) {
          console.error('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω–∞ –Ω–∏ –æ–¥–Ω–∞ subcategory –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –°–æ–∑–¥–∞–π—Ç–µ subcategory –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –º–µ—Å—Ç.');
          continue;
        }
        
        // –ù–∞—Ö–æ–¥–∏–º city (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
        const existingCity = await prisma.city.findFirst();
        if (!existingCity) {
          console.error('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω –Ω–∏ –æ–¥–∏–Ω city –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –°–æ–∑–¥–∞–π—Ç–µ city –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –º–µ—Å—Ç.');
          continue;
        }
        
        // –°–æ–∑–¥–∞–µ–º –º–µ—Å—Ç–æ
        const venue = await prisma.venuePartner.create({
          data: {
            name: venueData.name,
            slug: slug,
            description: venueData.description || null,
            coverImage: venueData.image,
            additionalImages: venueData.additionalImages || null,
            address: venueData.location,
            district: venueData.district || null,
            metro: venueData.metro || null,
            priceFrom: venueData.priceFrom || null,
            priceTo: venueData.priceTo || null,
            tariff: (venueData.tariff as any) || 'FREE',
            status: (venueData.status as any) || 'ACTIVE',
            moderationReason: venueData.moderationReason || null,
            timezone: venueData.timezone || null,
            fiasId: venueData.fiasId || null,
            kladrId: venueData.kladrId || null,
            workingHours: venueData.workingHours || null,
            city: {
              connect: { id: existingCity.id }
            },
            subcategory: {
              connect: { id: existingSubcategory.id }
            },
            vendor: {
              connect: { id: existingVendor.id }
            },
            lat: lat,
            lng: lng,
            ageFrom: venueData.ageFrom || null,
            ageTo: venueData.ageTo || null,
            richDescription: venueData.richDescription || null,
            createdAt: new Date(),
            updatedAt: new Date(),
          }
        });
        
        console.log(`‚úÖ –ú–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–æ: ${venue.name}`);
        successCount++;
        
      } catch (error) {
        console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–µ—Å—Ç–∞ "${venueData.name}":`, error);
        errorCount++;
      }
    }
    
    console.log(`\nüìà –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ—Å—Ç:`);
    console.log(`‚úÖ –£—Å–ø–µ—à–Ω–æ: ${successCount}`);
    console.log(`‚ùå –û—à–∏–±–æ–∫: ${errorCount}`);
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–µ—Å—Ç:', error);
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ Excel
export async function exportToExcel(eventsOutputPath?: string, venuesOutputPath?: string) {
  const timestamp = new Date().toISOString().slice(0, 10);
  const defaultEventsPath = path.join(process.cwd(), 'src', 'data', `events-${timestamp}.xlsx`);
  const defaultVenuesPath = path.join(process.cwd(), 'src', 'data', `venues-${timestamp}.xlsx`);
  
  try {
    console.log('üì§ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –≤ Excel...');
    
    // –≠–∫—Å–ø–æ—Ä—Ç –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π
    const events = await prisma.afishaEvent.findMany({
      select: {
        id: true,
        title: true,
        description: true,
        coverImage: true,
        gallery: true,
        tickets: true,
        startDate: true,
        endDate: true,
        venue: true,
        organizer: true,
        minPrice: true,
        isPaid: true,
        city: true,
        citySlug: true,
        categoryName: true,
        categoryId: true,
        coordinates: true,
        ageFrom: true,
        ageTo: true,
        ageGroups: true,
        isPopular: true,
        isPromoted: true,
        priority: true,
        status: true,
        order: true,
        quickFilterIds: true,
        richDescription: true,
        createdAt: true,
        updatedAt: true,
      },
      orderBy: { createdAt: 'desc' }
    });
    
    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è Excel
    const eventsForExcel = events.map(event => ({
      title: event.title,
      description: event.description,
      image: event.coverImage,
      gallery: event.gallery,
      tickets: event.tickets,
      startDate: event.startDate ? event.startDate.toISOString() : null,
      endDate: event.endDate ? event.endDate.toISOString() : null,
      location: event.venue,
      organizer: event.organizer,
      minPrice: event.minPrice,
      isPaid: event.isPaid,
      city: event.city,
      citySlug: event.citySlug,
      category: event.categoryName,
      categoryId: event.categoryId,
      coordinates: event.coordinates,
      ageFrom: event.ageFrom,
      ageTo: event.ageTo,
      ageGroups: event.ageGroups,
      isPopular: event.isPopular,
      isPromoted: event.isPromoted,
      priority: event.priority,
      status: event.status,
      order: event.order,
      quickFilterIds: event.quickFilterIds,
      richDescription: event.richDescription,
      createdAt: event.createdAt ? event.createdAt.toISOString() : null,
      updatedAt: event.updatedAt ? event.updatedAt.toISOString() : null,
    }));
    
    // –°–æ–∑–¥–∞–µ–º Excel —Ñ–∞–π–ª –¥–ª—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π
    const eventsWorkbook = XLSX.utils.book_new();
    const eventsSheet = XLSX.utils.json_to_sheet(eventsForExcel);
    XLSX.utils.book_append_sheet(eventsWorkbook, eventsSheet, 'Events');
    XLSX.writeFile(eventsWorkbook, eventsOutputPath || defaultEventsPath);
    console.log(`‚úÖ –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤: ${eventsOutputPath || defaultEventsPath}`);
    
    // –≠–∫—Å–ø–æ—Ä—Ç –º–µ—Å—Ç
    const venues = await prisma.venuePartner.findMany({
      select: {
        id: true,
        name: true,
        description: true,
        coverImage: true,
        additionalImages: true,
        address: true,
        district: true,
        metro: true,
        priceFrom: true,
        priceTo: true,
        tariff: true,
        status: true,
        moderationReason: true,
        timezone: true,
        fiasId: true,
        kladrId: true,
        workingHours: true,
        lat: true,
        lng: true,
        ageFrom: true,
        ageTo: true,
        richDescription: true,
        createdAt: true,
        updatedAt: true,
        city: {
          select: {
            name: true,
            slug: true,
          }
        },
        subcategory: {
          select: {
            name: true,
            slug: true,
          }
        }
      },
      orderBy: { createdAt: 'desc' }
    });
    
    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è Excel
    const venuesForExcel = venues.map(venue => ({
      name: venue.name,
      description: venue.description,
      image: venue.coverImage,
      additionalImages: venue.additionalImages,
      location: venue.address,
      district: venue.district,
      metro: venue.metro,
      priceFrom: venue.priceFrom,
      priceTo: venue.priceTo,
      city: venue.city.name,
      citySlug: venue.city.slug,
      subcategory: venue.subcategory.name,
      coordinates: venue.lat && venue.lng ? `${venue.lat},${venue.lng}` : null,
      ageFrom: venue.ageFrom,
      ageTo: venue.ageTo,
      tariff: venue.tariff,
      status: venue.status,
      moderationReason: venue.moderationReason,
      timezone: venue.timezone,
      fiasId: venue.fiasId,
      kladrId: venue.kladrId,
      workingHours: venue.workingHours,
      richDescription: venue.richDescription,
      createdAt: venue.createdAt ? venue.createdAt.toISOString() : null,
      updatedAt: venue.updatedAt ? venue.updatedAt.toISOString() : null,
    }));
    
    // –°–æ–∑–¥–∞–µ–º Excel —Ñ–∞–π–ª –¥–ª—è –º–µ—Å—Ç
    const venuesWorkbook = XLSX.utils.book_new();
    const venuesSheet = XLSX.utils.json_to_sheet(venuesForExcel);
    XLSX.utils.book_append_sheet(venuesWorkbook, venuesSheet, 'Venues');
    XLSX.writeFile(venuesWorkbook, venuesOutputPath || defaultVenuesPath);
    console.log(`‚úÖ –ú–µ—Å—Ç–∞ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤: ${venuesOutputPath || defaultVenuesPath}`);
    
    console.log('\nüéâ –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel –∑–∞–≤–µ—Ä—à–µ–Ω!');
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –≤ Excel:', error);
  } finally {
    await prisma.$disconnect();
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
export async function clearEventsAndVenues() {
  try {
    console.log('üßπ –û—á–∏—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ...');
    
    // –£–¥–∞–ª—è–µ–º –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
    const deletedEvents = await prisma.afishaEvent.deleteMany();
    console.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π: ${deletedEvents.count}`);
    
    // –£–¥–∞–ª—è–µ–º –º–µ—Å—Ç–∞
    const deletedVenues = await prisma.venuePartner.deleteMany();
    console.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω–æ –º–µ—Å—Ç: ${deletedVenues.count}`);
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –¥–∞–Ω–Ω—ã—Ö:', error);
  }
}

// –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
export async function loadDataFromExcel(eventsFile?: string, venuesFile?: string, clearFirst = false) {
  try {
    if (clearFirst) {
      await clearEventsAndVenues();
    }
    
    if (eventsFile) {
      await loadEventsFromExcel(eventsFile);
    }
    
    if (venuesFile) {
      await loadVenuesFromExcel(venuesFile);
    }
    
    console.log('\nüéâ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–∞!');
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö:', error);
  } finally {
    await prisma.$disconnect();
  }
}

// –ó–∞–ø—É—Å–∫ –∑–∞–≥—Ä—É–∑–∫–∏ (–µ—Å–ª–∏ —Ñ–∞–π–ª –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é)
if (require.main === module) {
  const args = process.argv.slice(2);
  const clearFirst = args.includes('--clear');
  const isExport = args.includes('--export');
  
  if (isExport) {
    const eventsFile = args.find(arg => arg.endsWith('.xlsx') && !arg.includes('venues'));
    const venuesFile = args.find(arg => arg.endsWith('.xlsx') && arg.includes('venues'));
    exportToExcel(eventsFile, venuesFile);
  } else {
    const eventsFile = args.find(arg => arg.endsWith('.xlsx') && !arg.includes('venues'));
    const venuesFile = args.find(arg => arg.endsWith('.xlsx') && arg.includes('venues'));
    loadDataFromExcel(eventsFile, venuesFile, clearFirst);
  }
}
