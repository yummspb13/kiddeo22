import { NextRequest, NextResponse } from "next/server"

export async function POST(request: NextRequest) {
  try {
    const { query, city } = await request.json()

    if (!query) {
      return NextResponse.json({ error: "Query is required" }, { status: 400 })
    }

    // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ChatGPT API
    // –ü–æ–∫–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∑–∞–≥–ª—É—à–∫—É
    const aiResponse = await generateAIResponse(query, city)

    return NextResponse.json({
      query,
      city,
      response: aiResponse,
      suggestions: [
        {
          id: "1",
          title: "–ú–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å –ø–æ –ª–µ–ø–∫–µ –¥–ª—è –¥–µ—Ç–µ–π 5-7 –ª–µ—Ç",
          description: "–¢–≤–æ—Ä—á–µ—Å–∫–æ–µ –∑–∞–Ω—è—Ç–∏–µ —Å –≥–ª–∏–Ω–æ–π",
          price: 1200,
          category: "–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ",
          rating: 4.8,
          location: "–¶–µ–Ω—Ç—Ä —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞"
        },
        {
          id: "2", 
          title: "–î–µ—Ç—Å–∫–∏–π —Å–ø–µ–∫—Ç–∞–∫–ª—å '–ö–æ–ª–æ–±–æ–∫'",
          description: "–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Å–ø–µ–∫—Ç–∞–∫–ª—å –¥–ª—è —Å–∞–º—ã—Ö –º–∞–ª–µ–Ω—å–∫–∏—Ö",
          price: 800,
          category: "–¢–µ–∞—Ç—Ä",
          rating: 4.6,
          location: "–¢–µ–∞—Ç—Ä –∫—É–∫–æ–ª"
        },
        {
          id: "3",
          title: "–ü–∞—Ä–∫ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–π '–°–∫–∞–∑–∫–∞'",
          description: "–ë–æ–ª—å—à–æ–π –ø–∞—Ä–∫ —Å –∞—Ç—Ç—Ä–∞–∫—Ü–∏–æ–Ω–∞–º–∏",
          price: 1500,
          category: "–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è", 
          rating: 4.5,
          location: "–ü–∞—Ä–∫ –ì–æ—Ä—å–∫–æ–≥–æ"
        }
      ]
    })
  } catch (error) {
    console.error("AI Search error:", error)
    return NextResponse.json(
      { error: "Internal server error" },
      { status: 500 }
    )
  }
}

async function generateAIResponse(query: string, city: string): Promise<string> {
  // –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
  // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –≤—ã–∑–æ–≤ ChatGPT API
  
  const responses = {
    "—á—Ç–æ –¥–µ–ª–∞—Ç—å —Å —Ä–µ–±–µ–Ω–∫–æ–º 5 –ª–µ—Ç": `–î–ª—è —Ä–µ–±–µ–Ω–∫–∞ 5 –ª–µ—Ç –≤ ${city} —è —Ä–µ–∫–æ–º–µ–Ω–¥—É—é:

üé® **–¢–≤–æ—Ä—á–µ—Å–∫–∏–µ –∑–∞–Ω—è—Ç–∏—è**: –ú–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å—ã –ø–æ –ª–µ–ø–∫–µ, —Ä–∏—Å–æ–≤–∞–Ω–∏—é, –∞–ø–ø–ª–∏–∫–∞—Ü–∏–∏
üé≠ **–¢–µ–∞—Ç—Ä–∞–ª—å–Ω—ã–µ –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∏**: –î–µ—Ç—Å–∫–∏–µ —Å–ø–µ–∫—Ç–∞–∫–ª–∏ –∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è  
üèÉ **–°–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏**: –û–±—â–∞—è —Ñ–∏–∑–∏—á–µ—Å–∫–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞, –ø–ª–∞–≤–∞–Ω–∏–µ, —Ç–∞–Ω—Ü—ã
üé™ **–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è**: –ü–∞—Ä–∫–∏ –∞—Ç—Ç—Ä–∞–∫—Ü–∏–æ–Ω–æ–≤, –¥–µ—Ç—Å–∫–∏–µ –ø–ª–æ—â–∞–¥–∫–∏, –∏–≥—Ä–æ–≤—ã–µ —Ü–µ–Ω—Ç—Ä—ã
üìö **–û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã**: –†–∞–∑–≤–∏–≤–∞—é—â–∏–µ –∫—Ä—É–∂–∫–∏, —á—Ç–µ–Ω–∏–µ, –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∏–≥—Ä—ã

–í—Å–µ —ç—Ç–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–º–æ–≥—É—Ç —Ä–∞–∑–≤–∏—Ç—å —Ç–≤–æ—Ä—á–µ—Å–∫–∏–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏, —Ñ–∏–∑–∏—á–µ—Å–∫—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ –Ω–∞–≤—ã–∫–∏ –≤–∞—à–µ–≥–æ —Ä–µ–±–µ–Ω–∫–∞.`,

    "–≤—ã—Ö–æ–¥–Ω—ã–µ —Å —Ä–µ–±–µ–Ω–∫–æ–º": `–û—Ç–ª–∏—á–Ω—ã–µ –∏–¥–µ–∏ –¥–ª—è –≤—ã—Ö–æ–¥–Ω—ã—Ö —Å —Ä–µ–±–µ–Ω–∫–æ–º –≤ ${city}:

üåÖ **–£—Ç—Ä–æ–º**: –ü–æ—Å–µ—Ç–∏—Ç–µ –¥–µ—Ç—Å–∫–∏–π —Å–ø–µ–∫—Ç–∞–∫–ª—å –∏–ª–∏ –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å
üåû **–î–Ω–µ–º**: –°—Ö–æ–¥–∏—Ç–µ –≤ –ø–∞—Ä–∫ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–π –∏–ª–∏ –Ω–∞ –¥–µ—Ç—Å–∫—É—é –ø–ª–æ—â–∞–¥–∫—É
üåÜ **–í–µ—á–µ—Ä–æ–º**: –°–µ–º–µ–π–Ω—ã–π —É–∂–∏–Ω –≤ –¥–µ—Ç—Å–∫–æ–º –∫–∞—Ñ–µ –∏–ª–∏ –¥–æ–º–∞

–†–µ–∫–æ–º–µ–Ω–¥—É—é –∑–∞—Ä–∞–Ω–µ–µ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –±–∏–ª–µ—Ç—ã –Ω–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è!`,

    "–ø—Ä–∞–∑–¥–Ω–∏–∫ –¥–ª—è –¥–µ—Ç–µ–π": `–î–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –¥–µ—Ç—Å–∫–æ–≥–æ –ø—Ä–∞–∑–¥–Ω–∏–∫–∞ –≤ ${city} –ø—Ä–µ–¥–ª–∞–≥–∞—é:

üéÇ **–î–æ–º–∞—à–Ω–∏–π –ø—Ä–∞–∑–¥–Ω–∏–∫**: –ó–∞–∫–∞–∂–∏—Ç–µ –∞–Ω–∏–º–∞—Ç–æ—Ä–∞ –∏ —É–∫—Ä–∞—à–µ–Ω–∏—è
üè¢ **–í —Ä–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ–º —Ü–µ–Ω—Ç—Ä–µ**: –ê—Ä–µ–Ω–¥—É–π—Ç–µ –ø–æ–º–µ—â–µ–Ω–∏–µ —Å –∞—Ç—Ç—Ä–∞–∫—Ü–∏–æ–Ω–∞–º–∏
üé™ **–ù–∞ –ø—Ä–∏—Ä–æ–¥–µ**: –û—Ä–≥–∞–Ω–∏–∑—É–π—Ç–µ –ø–∏–∫–Ω–∏–∫ –≤ –ø–∞—Ä–∫–µ —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –∏–≥—Ä–∞–º–∏
üé≠ **–í —Ç–µ–∞—Ç—Ä–µ**: –ó–∞–∫–∞–∂–∏—Ç–µ –≥—Ä—É–ø–ø–æ–≤–æ–π –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç—Å–∫–æ–≥–æ —Å–ø–µ–∫—Ç–∞–∫–ª—è

–ù–µ –∑–∞–±—É–¥—å—Ç–µ –ø—Ä–æ —Ç–æ—Ä—Ç, –ø–æ–¥–∞—Ä–∫–∏ –∏ —Ñ–æ—Ç–æ—Å—ä–µ–º–∫—É!`
  }

  const lowerQuery = query.toLowerCase()
  
  for (const [key, response] of Object.entries(responses)) {
    if (lowerQuery.includes(key)) {
      return response
    }
  }

  return `–Ø –ø–æ–º–æ–≥—É –Ω–∞–π—Ç–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –¥–ª—è –≤–∞—à–µ–≥–æ —Ä–µ–±–µ–Ω–∫–∞ –≤ ${city}. 

–û—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ –≤–∞—à–µ–º –∑–∞–ø—Ä–æ—Å–µ "${query}", —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞:

‚Ä¢ –¢–≤–æ—Ä—á–µ—Å–∫–∏–µ –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å—ã
‚Ä¢ –î–µ—Ç—Å–∫–∏–µ —Å–ø–µ–∫—Ç–∞–∫–ª–∏ –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è  
‚Ä¢ –°–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ —Å–µ–∫—Ü–∏–∏
‚Ä¢ –†–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–µ —Ü–µ–Ω—Ç—Ä—ã
‚Ä¢ –û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã

–í—Å–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ–¥ –≤–æ–∑—Ä–∞—Å—Ç —Ä–µ–±–µ–Ω–∫–∞ –∏ –ø—Ä–æ–≤–æ–¥—è—Ç—Å—è –æ–ø—ã—Ç–Ω—ã–º–∏ –ø–µ–¥–∞–≥–æ–≥–∞–º–∏.`
}
