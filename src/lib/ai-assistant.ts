// src/lib/ai-assistant.ts
import prisma from "@/lib/db"
import { AIAssistantType, AIAssistantStatus } from "@prisma/client"

export interface AIRequest {
  vendorId: number
  type: AIAssistantType
  prompt: string
  metadata?: unknown
}

export interface AIResponse {
  id: number
  response: string
  tokensUsed: number
  cost: number
  status: AIAssistantStatus
}

// –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –∫ –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫—É
export async function createAIRequest(request: AIRequest): Promise<AIResponse> {
  const aiRequest = await prisma.aIAssistant.create({
    data: {
      vendorId: request.vendorId,
      type: request.type,
      prompt: request.prompt,
      metadata: request.metadata as any,
      status: 'PENDING'
    }
  })

  // –í —Ä–µ–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –≤—ã–∑–æ–≤ OpenAI API
  // –ü–æ–∫–∞ —á—Ç–æ —Å–∏–º—É–ª–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É
  return simulateAIProcessing(aiRequest.id, request)
}

// –°–∏–º—É–ª—è—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ò–ò (–∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è OpenAI)
async function simulateAIProcessing(id: number, request: AIRequest): Promise<AIResponse> {
  // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ "–æ–±—Ä–∞–±–æ—Ç–∫–∞"
  await prisma.aIAssistant.update({
    where: { id },
    data: { status: 'PROCESSING' }
  })

  // –°–∏–º—É–ª—è—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
  await new Promise(resolve => setTimeout(resolve, 2000))

  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∑–∞–ø—Ä–æ—Å–∞
  const response = generateMockResponse(request.type, request.prompt)
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
  const updated = await prisma.aIAssistant.update({
    where: { id },
    data: {
      status: 'COMPLETED',
      response: response.text,
      tokensUsed: response.tokensUsed,
      cost: response.cost,
      completedAt: new Date()
    }
  })

  return {
    id: updated.id,
    response: updated.response!,
    tokensUsed: updated.tokensUsed!,
    cost: updated.cost!,
    status: updated.status
  }
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–æ–∫-–æ—Ç–≤–µ—Ç–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∑–∞–ø—Ä–æ—Å–∞
function generateMockResponse(type: AIAssistantType, prompt: string) {
  const responses = {
    PROMO_ADVICE: {
      text: `–ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –≤–∞—à–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ "${prompt}", —Ä–µ–∫–æ–º–µ–Ω–¥—É—é:

1. **–õ—É—á—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏**: –í—ã—Ö–æ–¥–Ω—ã–µ –¥–Ω–∏ —Å 10:00 –¥–æ 12:00 –∏ —Å 15:00 –¥–æ 17:00
2. **–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ —Å–ª–æ—Ç—ã**: –ü—è—Ç–Ω–∏—Ü–∞ 18:00-20:00, —Å—É–±–±–æ—Ç–∞ 10:00-12:00, –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ 15:00-17:00
3. **–°—Ç—Ä–∞—Ç–µ–≥–∏—è –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è**: 
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —è—Ä–∫–∏–µ, –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
   - –î–æ–±–∞–≤—å—Ç–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ü–µ—Ä–≤—ã–µ 5 –∑–∞–ø–∏—Å–µ–π —Å–æ —Å–∫–∏–¥–∫–æ–π 20%")
   - –£–∫–∞–∂–∏—Ç–µ –≤–æ–∑—Ä–∞—Å—Ç–Ω—É—é –≥—Ä—É–ø–ø—É –∏ —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏

4. **–ö–æ–Ω—Ç–µ–Ω—Ç-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è**:
   - –ü–æ–∫–∞–∂–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã –≤ –∫–æ—Ä–æ—Ç–∫–æ–º –≤–∏–¥–µ–æ
   - –î–æ–±–∞–≤—å—Ç–µ –æ—Ç–∑—ã–≤—ã –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
   - –°–æ–∑–¥–∞–π—Ç–µ –∏–Ω—Ç—Ä–∏–≥—É –≤ –æ–ø–∏—Å–∞–Ω–∏–∏

–≠—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ –∞–Ω–∞–ª–∏–∑–µ —É—Å–ø–µ—à–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –≤ –≤–∞—à–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.`,
      tokensUsed: 180,
      cost: 0.036
    },
    PRICING_ANALYSIS: {
      text: `–ê–Ω–∞–ª–∏–∑ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–ª—è "${prompt}":

**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è –Ω–∞ —Ä—ã–Ω–∫–µ:**
- –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –≤ –≤–∞—à–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: 800-1200‚ÇΩ
- –ü—Ä–µ–º–∏—É–º-—Å–µ–≥–º–µ–Ω—Ç: 1500-2500‚ÇΩ
- –ë—é–¥–∂–µ—Ç–Ω—ã–π —Å–µ–≥–º–µ–Ω—Ç: 400-600‚ÇΩ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—é:**
1. **–û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞**: 900‚ÇΩ (–Ω–∞ 10% –Ω–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–π –¥–ª—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤)
2. **–°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è**:
   - –ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞: 900‚ÇΩ
   - –†–∞–Ω–Ω–µ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (–∑–∞ 2 –Ω–µ–¥–µ–ª–∏): 750‚ÇΩ (-17%)
   - –ì—Ä—É–ø–ø–æ–≤—ã–µ —Å–∫–∏–¥–∫–∏ (–æ—Ç 3 —á–µ–ª–æ–≤–µ–∫): 800‚ÇΩ (-11%)
   - VIP-–ø–∞–∫–µ—Ç —Å –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏: 1200‚ÇΩ (+33%)

3. **–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∞—Å–ø–µ–∫—Ç—ã**:
   - –¶–µ–Ω–∞ 899‚ÇΩ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –ª—É—á—à–µ, —á–µ–º 900‚ÇΩ
   - –ü–æ–∫–∞–∂–∏—Ç–µ —ç–∫–æ–Ω–æ–º–∏—é –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞–º–∏
   - –î–æ–±–∞–≤—å—Ç–µ "–≥–∞—Ä–∞–Ω—Ç–∏—é –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å—Ä–µ–¥—Å—Ç–≤"

**–ü—Ä–æ–≥–Ω–æ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏—é**: +25-30% –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø–æ–¥–∞—á–µ —Ü–µ–Ω—ã.`,
      tokensUsed: 220,
      cost: 0.044
    },
    CONTENT_GENERATION: {
      text: `–ì–µ–Ω–µ—Ä–∏—Ä—É—é –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è "${prompt}":

**–ó–∞–≥–æ–ª–æ–≤–æ–∫ (SEO-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π):**
"–ú–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å –ø–æ —Ä–∏—Å–æ–≤–∞–Ω–∏—é –¥–ª—è –¥–µ—Ç–µ–π 5-12 –ª–µ—Ç | –†–∞–∑–≤–∏—Ç–∏–µ —Ç–≤–æ—Ä—á–µ—Å–∫–∏—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π | –ú–æ—Å–∫–≤–∞"

**–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏):**
üé® –£–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å –ø–æ —Ä–∏—Å–æ–≤–∞–Ω–∏—é –¥–ª—è –¥–µ—Ç–µ–π! –†–∞–∑–≤–∏–≤–∞–µ–º —Ç–≤–æ—Ä—á–µ—Å–∫–∏–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏, —É—á–∏–º—Å—è —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ä–∞–∑–Ω—ã–º–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏ –∏ —Ç–µ—Ö–Ω–∏–∫–∞–º–∏. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö –∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—â–∏—Ö.

**–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:**
–ù–∞—à –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å - —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —É—Ä–æ–∫ —Ä–∏—Å–æ–≤–∞–Ω–∏—è, –∞ –Ω–∞—Å—Ç–æ—è—â–µ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –≤ –º–∏—Ä —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞! 

**–ß—Ç–æ –∂–¥–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:**
‚ú® –ò–∑—É—á–µ–Ω–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–µ—Ö–Ω–∏–∫ —Ä–∏—Å–æ–≤–∞–Ω–∏—è (–∞–∫–≤–∞—Ä–µ–ª—å, –≥—É–∞—à—å, –∫–∞—Ä–∞–Ω–¥–∞—à–∏)
‚ú® –†–∞–±–æ—Ç–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏
‚ú® –†–∞–∑–≤–∏—Ç–∏–µ –º–µ–ª–∫–æ–π –º–æ—Ç–æ—Ä–∏–∫–∏ –∏ –≤–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è
‚ú® –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –∫–∞—Ä—Ç–∏–Ω—ã –Ω–∞ –ø–∞–º—è—Ç—å
‚ú® –†–∞–±–æ—Ç–∞ –≤ –¥—Ä—É–∂–Ω–æ–π –∫–æ–º–∞–Ω–¥–µ —Å–≤–µ—Ä—Å—Ç–Ω–∏–∫–æ–≤

**–ü—Ä–æ–≥—Ä–∞–º–º–∞ –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å–∞:**
1. –ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ –∏ —Ä–∞–∑–º–∏–Ω–∫–∞ (15 –º–∏–Ω)
2. –ò–∑—É—á–µ–Ω–∏–µ —Ç–µ—Ö–Ω–∏–∫–∏ (30 –º–∏–Ω)
3. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ (45 –º–∏–Ω)
4. –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç (15 –º–∏–Ω)
5. –ß–∞–µ–ø–∏—Ç–∏–µ –∏ –æ–±—â–µ–Ω–∏–µ (15 –º–∏–Ω)

**–ß—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ –≤ —Å—Ç–æ–∏–º–æ—Å—Ç—å:**
- –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
- –†–∞–±–æ—Ç–∞ –æ–ø—ã—Ç–Ω–æ–≥–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è
- –ü–∞–º—è—Ç–Ω–∞—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è
- –°–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞

**–ü–æ—á–µ–º—É –≤—ã–±–∏—Ä–∞—é—Ç –Ω–∞—Å:**
- 5+ –ª–µ—Ç –æ–ø—ã—Ç–∞ —Ä–∞–±–æ—Ç—ã —Å –¥–µ—Ç—å–º–∏
- –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –∫–∞–∂–¥–æ–º—É —Ä–µ–±–µ–Ω–∫—É
- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥–∏–∫–∏ –æ–±—É—á–µ–Ω–∏—è
- –£—é—Ç–Ω–∞—è —Ç–≤–æ—Ä—á–µ—Å–∫–∞—è –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞

–ó–∞–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å! –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ.`,
      tokensUsed: 350,
      cost: 0.07
    },
    UTM_GENERATION: {
      text: `UTM-–º–µ—Ç–∫–∏ –¥–ª—è "${prompt}":

**–û—Å–Ω–æ–≤–Ω—ã–µ UTM-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- utm_source=google_ads
- utm_medium=cpc
- utm_campaign=masterclass_painting_2024
- utm_content=main_banner
- utm_term=–¥–µ—Ç—Å–∫–∏–π_–º–∞—Å—Ç–µ—Ä_–∫–ª–∞—Å—Å_—Ä–∏—Å–æ–≤–∞–Ω–∏–µ

**–ü–æ–ª–Ω–∞—è —Å—Å—ã–ª–∫–∞:**
https://your-site.com/event/masterclass-painting?utm_source=google_ads&utm_medium=cpc&utm_campaign=masterclass_painting_2024&utm_content=main_banner&utm_term=–¥–µ—Ç—Å–∫–∏–π_–º–∞—Å—Ç–µ—Ä_–∫–ª–∞—Å—Å_—Ä–∏—Å–æ–≤–∞–Ω–∏–µ

**–í–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤:**

1. **Google Ads:**
   - utm_source=google_ads
   - utm_medium=cpc
   - utm_campaign=masterclass_painting_2024

2. **VKontakte:**
   - utm_source=vkontakte
   - utm_medium=social
   - utm_campaign=masterclass_painting_2024

3. **Instagram:**
   - utm_source=instagram
   - utm_medium=social
   - utm_campaign=masterclass_painting_2024

4. **Email —Ä–∞—Å—Å—ã–ª–∫–∞:**
   - utm_source=email
   - utm_medium=newsletter
   - utm_campaign=masterclass_painting_2024

5. **–ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–µ —Å—Å—ã–ª–∫–∏:**
   - utm_source=partner_site
   - utm_medium=referral
   - utm_campaign=masterclass_painting_2024

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—é:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Google Analytics –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- –°–æ–∑–¥–∞–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ü–µ–ª–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –∫–æ–Ω–≤–µ—Ä—Å–∏—é –ø–æ UTM-–º–µ—Ç–∫–∞–º
- A/B —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã utm_content`,
      tokensUsed: 280,
      cost: 0.056
    },
    COMPETITOR_ANALYSIS: {
      text: `–ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –¥–ª—è "${prompt}":

**–¢–æ–ø-5 –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –≤ –≤–∞—à–µ–π –Ω–∏—à–µ:**

1. **"–¢–≤–æ—Ä—á–µ—Å–∫–∞—è —Å—Ç—É–¥–∏—è –ê—Ä—Ç"**
   - –¶–µ–Ω–∞: 1000‚ÇΩ
   - –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: –û–ø—ã—Ç–Ω—ã–µ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏, —Ö–æ—Ä–æ—à–∏–µ –æ—Ç–∑—ã–≤—ã
   - –°–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: –í—ã—Å–æ–∫–∞—è —Ü–µ–Ω–∞, –º–∞–ª–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–∞ —Å–∞–π—Ç–µ
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ö–æ–Ω–∫—É—Ä–∏—Ä—É–π—Ç–µ —Ü–µ–Ω–æ–π (900‚ÇΩ) –∏ –∫–∞—á–µ—Å—Ç–≤–æ–º –∫–æ–Ω—Ç–µ–Ω—Ç–∞

2. **"–î–µ—Ç—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä –†–∞–¥—É–≥–∞"**
   - –¶–µ–Ω–∞: 800‚ÇΩ
   - –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: –ù–∏–∑–∫–∞—è —Ü–µ–Ω–∞, —É–¥–æ–±–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ
   - –°–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: –ü–ª–æ—Ö–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ —Ñ–æ—Ç–æ, –Ω–µ—Ç –æ–Ω–ª–∞–π–Ω-–∑–∞–ø–∏—Å–∏
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ü–æ–¥—á–µ—Ä–∫–Ω–∏—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ –∏ —É–¥–æ–±—Å—Ç–≤–æ –∑–∞–ø–∏—Å–∏

3. **"–°—Ç—É–¥–∏—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è –ö–∞—Ä–∞–Ω–¥–∞—à"**
   - –¶–µ–Ω–∞: 1200‚ÇΩ
   - –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: –ü—Ä–µ–º–∏—É–º-–ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
   - –°–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: –í—ã—Å–æ–∫–∞—è —Ü–µ–Ω–∞, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –°–æ–∑–¥–∞–π—Ç–µ —Å—Ä–µ–¥–Ω–∏–π —Å–µ–≥–º–µ–Ω—Ç (900‚ÇΩ) —Å —Ö–æ—Ä–æ—à–∏–º –∫–∞—á–µ—Å—Ç–≤–æ–º

**–ö–ª—é—á–µ–≤—ã–µ –∏–Ω—Å–∞–π—Ç—ã:**
- –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞: 1000‚ÇΩ
- –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤: –æ–ø—ã—Ç, –º–∞—Ç–µ—Ä–∏–∞–ª—ã, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ
- –û–±—â–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏: –ø–ª–æ—Ö–æ–π —Å–∞–π—Ç, –Ω–µ—Ç –æ–Ω–ª–∞–π–Ω-–∑–∞–ø–∏—Å–∏, –º–∞–ª–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

**–í–∞—à–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
1. –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–∞–π—Ç —Å –æ–Ω–ª–∞–π–Ω-–∑–∞–ø–∏—Å—å—é
2. –ü—Ä–æ–∑—Ä–∞—á–Ω–æ–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
3. –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–≥—Ä–∞–º–º–µ
4. –ì–∏–±–∫–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
5. –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ –∏ –≤–∏–¥–µ–æ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—é:**
- "–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –¥–µ—Ç—Å–∫–æ–º—É —Ç–≤–æ—Ä—á–µ—Å—Ç–≤—É"
- "–£–¥–æ–±–Ω–∞—è –æ–Ω–ª–∞–π–Ω-–∑–∞–ø–∏—Å—å –∏ –æ–ø–ª–∞—Ç–∞"
- "–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–µ —Ü–µ–Ω—ã –±–µ–∑ —Å–∫—Ä—ã—Ç—ã—Ö –¥–æ–ø–ª–∞—Ç"
- "–û–ø—ã—Ç–Ω—ã–µ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏ —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–æ–¥–∏–∫–∞–º–∏"`,
      tokensUsed: 320,
      cost: 0.064
    },
    DESCRIPTION_GENERATION: {
      text: `–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–ø–∏—Å–∞–Ω–∏—è –¥–ª—è "${prompt}":

**SEO-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:**

"–ü—Ä–∏–≥–ª–∞—à–∞–µ–º –¥–µ—Ç–µ–π 5-12 –ª–µ—Ç –Ω–∞ —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å –ø–æ —Ä–∏—Å–æ–≤–∞–Ω–∏—é! –ù–∞—à–∏ –æ–ø—ã—Ç–Ω—ã–µ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏ –ø–æ–º–æ–≥—É—Ç –≤–∞—à–µ–º—É —Ä–µ–±–µ–Ω–∫—É —Ä–∞—Å–∫—Ä—ã—Ç—å —Ç–≤–æ—Ä—á–µ—Å–∫–∏–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –∏ –Ω–∞—É—á–∞—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏.

**–ß—Ç–æ –∂–¥–µ—Ç –Ω–∞ –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å–µ:**
‚Ä¢ –ò–∑—É—á–µ–Ω–∏–µ –æ—Å–Ω–æ–≤ —Ä–∏—Å–æ–≤–∞–Ω–∏—è –∞–∫–≤–∞—Ä–µ–ª—å—é –∏ –≥—É–∞—à—å—é
‚Ä¢ –†–∞–∑–≤–∏—Ç–∏–µ –º–µ–ª–∫–æ–π –º–æ—Ç–æ—Ä–∏–∫–∏ –∏ –≤–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è
‚Ä¢ –†–∞–±–æ—Ç–∞ –≤ –¥—Ä—É–∂–Ω–æ–π —Ç–≤–æ—Ä—á–µ—Å–∫–æ–π –∞—Ç–º–æ—Å—Ñ–µ—Ä–µ
‚Ä¢ –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –∫–∞—Ä—Ç–∏–Ω—ã –Ω–∞ –ø–∞–º—è—Ç—å

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–∞—à–µ–≥–æ –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å–∞:**
‚úÖ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –∫–∞–∂–¥–æ–º—É —Ä–µ–±–µ–Ω–∫—É
‚úÖ –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –≤–∫–ª—é—á–µ–Ω—ã –≤ —Å—Ç–æ–∏–º–æ—Å—Ç—å
‚úÖ –û–ø—ã—Ç–Ω—ã–µ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏ —Å –ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–º –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ–º
‚úÖ –£–¥–æ–±–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ —Ü–µ–Ω—Ç—Ä–µ –≥–æ—Ä–æ–¥–∞
‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–Ω–ª–∞–π–Ω-–∑–∞–ø–∏—Å–∏ –∏ –æ–ø–ª–∞—Ç—ã

**–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–Ω—è—Ç–∏—è:**
1. –ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ –∏ —Ä–∞–∑–º–∏–Ω–∫–∞ (15 –º–∏–Ω)
2. –ò–∑—É—á–µ–Ω–∏–µ —Ç–µ—Ö–Ω–∏–∫–∏ —Ä–∏—Å–æ–≤–∞–Ω–∏—è (30 –º–∏–Ω)
3. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ –Ω–∞–¥ –∫–∞—Ä—Ç–∏–Ω–æ–π (45 –º–∏–Ω)
4. –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç –∏ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ (15 –º–∏–Ω)
5. –ß–∞–µ–ø–∏—Ç–∏–µ –∏ –æ–±—â–µ–Ω–∏–µ (15 –º–∏–Ω)

**–ß—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ:**
- –†–∞–±–æ—Ç–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è
- –í—Å–µ —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
- –ü–∞–º—è—Ç–Ω–∞—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è
- –°–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
- –õ–µ–≥–∫–∏–µ –∑–∞–∫—É—Å–∫–∏ –∏ —á–∞–π

–ó–∞–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å! –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ. –°–∫–∏–¥–∫–∞ 20% –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –∑–∞ –Ω–µ–¥–µ–ª—é –¥–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è."

**–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è SEO:**
–º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å —Ä–∏—Å–æ–≤–∞–Ω–∏–µ –¥–µ—Ç–∏, –¥–µ—Ç—Å–∫–æ–µ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ, —É—Ä–æ–∫–∏ —Ä–∏—Å–æ–≤–∞–Ω–∏—è, —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —Å—Ç—É–¥–∏—è, —Ä–∞–∑–≤–∏—Ç–∏–µ —Ç–≤–æ—Ä—á–µ—Å–∫–∏—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π`,
      tokensUsed: 400,
      cost: 0.08
    }
  }

  return responses[type] || {
    text: `–û—Ç–≤–µ—Ç –Ω–∞ –≤–∞—à –∑–∞–ø—Ä–æ—Å "${prompt}" –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.`,
    tokensUsed: 50,
    cost: 0.01
  }
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤–µ–Ω–¥–æ—Ä–∞
export async function getVendorAIHistory(vendorId: number, limit: number = 20) {
  return await prisma.aIAssistant.findMany({
    where: { vendorId },
    orderBy: { createdAt: 'desc' },
    take: limit
  })
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –¥–ª—è –≤–µ–Ω–¥–æ—Ä–∞
export async function getVendorRecommendations(vendorId: number) {
  return await prisma.aIRecommendation.findMany({
    where: { vendorId },
    orderBy: [{ priority: 'desc' }, { createdAt: 'desc' }]
  })
}

// –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
export async function createRecommendation(data: {
  vendorId: number
  listingId?: number
  type: string
  title: string
  description: string
  priority: number
}) {
  return await prisma.aIRecommendation.create({
    data
  })
}

// –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
export async function applyRecommendation(id: number) {
  return await prisma.aIRecommendation.update({
    where: { id },
    data: {
      isApplied: true,
      appliedAt: new Date()
    }
  })
}
